<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="/eel.js"></script>
    <title>IoT GUI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="row align-items-center">
            <div class="col">
                <h1>Ecological Environment Monitoring System</h1>
            </div>
        </div>
        <div class="row my-3">
            <div class="col text-center">
                <input id="reset-button" class="btn btn-success center-block my-1" type="button" value="RESET" onclick="reset()"><br>
                <input id="demo1-button" class="btn btn-success center-block my-1" type="button" value="DEMO1" onclick="demo_1()"><br>
                <input id="demo2-button" class="btn btn-success center-block my-1" type="button" value="DEMO2" onclick="demo_2()"><br>
                <input id="demo3-button" class="btn btn-success center-block my-1" type="button" value="DEMO3" onclick="demo_3()">
            </div>
            <div class="col-7">
                <form onsubmit="return false;">
                    <div class="mb-3">
                        <label for="device_id" class="form-label">デバイスID</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="device_id" name="device_id" pattern="[0-9a-f]{10}" required="required"
                                placeholder="000101XXXX">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="username" class="form-label">メールアドレス</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="username" name="username" pattern="([g]{1}[0-9]{3}[c]{1}[0-9]{4})" required="required"
                                placeholder="g021cXXXX">
                            <span class="input-group-text">@</span>
                            <input type="text" class="form-control" placeholder="Server" value="g.neec.ac.jp" disabled readonly>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="from_date" class="form-label">参照開始日</label>
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="YYYYMMDD" id="from_date" name="from_date" pattern="([2]{1}[0-9]{3}[0-1][0-9][0-3][0-9])" required="required">
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="to_date" class="form-label">参照終了日</label>
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="YYYYMMDD" id="to_date" name="to_date" pattern="([2]{1}[0-9]{3}[0-1][0-9][0-3][0-9])" required="required">
                        </div>
                        <div class="form-text" id="basic-addon4">参照間隔は<div style="color: red; display: inline-block; _display: inline;">3日以内</div>にしてください</div>
                    </div>
                    <div class="mb-3">
                        <div id="alert" role="alert"></div>
                    </div>


                    <div class="row align-items-center my-4">
                        <div class="col text-center">
                            <input type="button" class="btn btn-success center-block" id="genmap-button" value="地図を生成し表示" onclick="GenerateMap_Display()">
                        </div>
                    </div>




                </form>
            </div>
            <div class="col"></div>
        </div>
    </div>

    <style>
        h1 {
            position: relative;
            padding: 1em;
        }
        h1:after {
            position: absolute;
            content: "";
            left: 0;
            bottom: 0;
            width: 100%;
            height: 10px;
            background: repeating-linear-gradient(-45deg, #16a559, #16a559 5px, #ffffff 5px, #ffffff 10px);
        }
    </style>

    <script>
        document.getElementById("alert").style.display = "none";
        var submitButton = document.getElementById('submit-button');
        var generateButton = document.getElementById('genmap-button');
        var err_flag = false;

        function UpdateValues() {
            document.getElementById("alert").style.display = "none";
            var device_id = document.getElementById('device_id').value;
            var username = document.getElementById('username').value;
            var from_date = document.getElementById('from_date').value;
            var to_date = document.getElementById('to_date').value;
            var check_date = parseInt(to_date, 10) - parseInt(from_date, 10);
            if (2 < check_date){
                alert("参照日時は3日以内にしてください")
                err_flag = true;
            }else{
                eel.update_values(device_id, username, from_date, to_date);
                err_flag = false;
            }
        };
        function GenerateMap_Display() {
            generateButton.disabled = true;
            UpdateValues();
            if (err_flag){
                generateButton.disabled = false;
            } else {
                eel.generate_map_display();
            }
        }
        function reset() {
            document.getElementById('device_id').value = "";
            document.getElementById('username').value = "";
            document.getElementById('from_date').value = "";
            document.getElementById('to_date').value = "";
        }
        function demo_1() {
            document.getElementById('device_id').value = "000101a510";
            document.getElementById('username').value = "g021c1047";
            document.getElementById('from_date').value = "20230909";
            document.getElementById('to_date').value = "20230911";
        }
        function demo_2() {
            document.getElementById('device_id').value = "000101a511";
            document.getElementById('username').value = "g021c1047";
            document.getElementById('from_date').value = "20230909";
            document.getElementById('to_date').value = "20230911";
        }
        function demo_3() {
            document.getElementById('device_id').value = "000101a510";
            document.getElementById('username').value = "g021c1047";
            document.getElementById('from_date').value = "20230909";
            document.getElementById('to_date').value = "20230912";
        }
        eel.expose(enable_button);
        function enable_button() {
            generateButton.disabled = false;
        }
        eel.expose(alert);
        function alert(message) {
            document.getElementById("alert").style.display = "none";
            document.getElementById("alert").className = "alert alert-danger"
            document.getElementById("alert").innerHTML = message;
            document.getElementById("alert").style.display = "block";
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
</body>

</html>